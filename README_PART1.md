# README PART 1: Техническая спецификация и архитектура генератора датасета

## Структура проекта

```
dataset-creation-paid-clinic/
├── README.md                    # Основное описание проекта
├── README_PART1.md             # Техническая спецификация (этот файл)
├── dataset_generator.py        # Основной модуль генерации датасета
├── data_dictionaries.py        # Словари данных (ФИО, симптомы, врачи, анализы)
├── validators.py               # Валидаторы форматов и уникальности
├── utils.py                    # Вспомогательные функции
├── config.py                   # Конфигурация генератора
└── requirements.txt            # Зависимости Python
```

## Схема датасета

| № | Колонка | Тип данных | Пример значения | Ограничения | Валидация |
|---|---------|------------|-----------------|-------------|-----------|
| 1 | FIO | str | "Иванов Иван Иванович" | Только славянские ФИО | Проверка словаря |
| 2 | passport_data | str | "1234 123456" | RU/BY/KZ форматы | Уникальность |
| 3 | SNILS | str | "123-456-789 12" | Формат РФ | Уникальность по клиенту |
| 4 | symptoms | str | "боль в горле, температура" | Макс. 10 симптомов | Проверка словаря |
| 5 | doctor_choice | str | "лор" | Мин. 50 специальностей | Проверка словаря |
| 6 | visit_date | str | "2024-01-15T09:30+03:00" | ISO 8601, рабочие дни | Формат, рабочее время |
| 7 | analyses | str | "мазок на ковид, общий анализ крови" | Макс. 5 анализов | Проверка словаря |
| 8 | analysis_date | str | "2024-01-17T14:00+03:00" | ISO 8601, через 24-72ч | Формат, интервал |
| 9 | analysis_cost | str | "2000 руб." | Только рубли | Положительное число |
| 10 | payment_card | str | "1234 5678 1234 5678" | Банковский формат | Макс. 5 повторов |

## Архитектура решения

### 1. Модуль словарей данных (data_dictionaries.py)
```python
# Славянские ФИО (мин. 10000 комбинаций)
SLAVIC_SURNAMES = [...]  # Русские, украинские, белорусские фамилии
SLAVIC_NAMES_MALE = [...] # Мужские имена
SLAVIC_NAMES_FEMALE = [...] # Женские имена
SLAVIC_PATRONYMICS_MALE = [...] # Отчества для мужчин
SLAVIC_PATRONYMICS_FEMALE = [...] # Отчества для женщин

# Симптомы (мин. 5000)
SYMPTOMS_DICT = [...]  # Медицинские симптомы

# Врачи (мин. 50 специальностей)
DOCTORS_SPECIALIZATIONS = [...]

# Анализы (мин. 250)
MEDICAL_ANALYSES = [...]

# Банки и платежные системы
BANKS_DATA = {...}  # Сбербанк, ВТБ, Альфа-Банк и т.д.
PAYMENT_SYSTEMS = [...] # Visa, MasterCard, МИР
```

### 2. Генераторы уникальных данных
```python
def generate_unique_passport(country_code):
    """Генерация уникальных паспортных данных для RU/BY/KZ"""

def generate_unique_SNILS(fio, passport):
    """Генерация СНИЛС, привязанного к клиенту"""

def generate_working_datetime(start_date, end_date):
    """Генерация даты/времени в рабочие дни и часы"""
```

### 3. Бизнес-логика и зависимости
```python
def match_symptoms_to_doctor(symptoms_list):
    """Подбор врача по симптомам с вероятностным распределением"""

def generate_relevant_analyses(symptoms, doctor_specialization):
    """Генерация релевантных анализов на основе симптомов и врача"""

def calculate_analyses_cost(analyses_list):
    """Расчет стоимости анализов с реалистичным разбросом"""
```

## Алгоритм генерации данных

### Этап 1: Инициализация
1. Загрузка словарей данных
2. Инициализация генераторов случайных чисел с фиксированным seed
3. Создание структур для отслеживания уникальности

### Этап 2: Генерация клиентской базы
1. Создание уникальных клиентов (ФИО + паспорт + СНИЛС)
2. Определение вероятности повторных визитов (20-30%)

### Этап 3: Генерация визитов
Для каждой записи в датасете:
1. Выбор клиента (новый или существующий)
2. Генерация симптомов (1-10 штук)
3. Подбор врача по симптомам
4. Генерация даты визита (рабочие дни/часы)
5. Генерация релевантных анализов (1-5 штук)
6. Расчет даты получения анализов (+24-72 часа)
7. Расчет стоимости
8. Генерация платежной карты

### Этап 4: Валидация и экспорт
1. Проверка всех ограничений
2. Валидация форматов
3. Экспорт в .xlsx файл

## Конфигурация генератора

### config.py параметры:
- `DATASET_SIZE`: количество записей (по умолчанию 50000)
- `RANDOM_SEED`: фиксированный seed для воспроизводимости
- `WORK_HOURS`: рабочие часы поликлиники (09:00-18:00)
- `WORK_DAYS`: рабочие дни недели (пн-пт)
- `TIMEZONE`: часовой пояс (по умолчанию +03:00 MSK)
- `CLIENT_REPEAT_PROBABILITY`: вероятность повторного визита (0.25)
- `MAX_SYMPTOMS_PER_VISIT`: максимум симптомов (10)
- `MAX_ANALYSES_PER_VISIT`: максимум анализов (5)
- `CARD_REUSE_LIMIT`: лимит повторов карты (5)

### Распределения вероятностей:
- Банки: Сбербанк (40%), ВТБ (20%), Альфа-Банк (15%), другие (25%)
- Платежные системы: МИР (50%), Visa (30%), MasterCard (20%)
- Количество симптомов: нормальное распределение со средним 2-3
- Количество анализов: нормальное распределение со средним 1-2

## Обеспечение качества данных

### Валидаторы:
1. **Формат паспорта**: проверка соответствия форматам RU/BY/KZ
2. **Формат СНИЛС**: проверка контрольной суммы
3. **Формат карты**: проверка алгоритма Луна
4. **Временные интервалы**: проверка рабочих дней/часов
5. **Уникальность**: отслеживание уникальных паспортов и СНИЛС

### Инварианты:
- Дата анализов всегда после даты визита
- СНИЛС уникален, но привязан к клиенту
- Симптомы соответствуют специализации врача (с учетом вероятностей)
- Анализы релевантны симптомам и врачу

## Производительность

### Оптимизации для 50k+ записей:
1. **Пакетная обработка**: генерация данных блоками по 1000 записей
2. **Кэширование**: кэширование часто используемых комбинаций
3. **Потоковая запись**: запись в xlsx без полной загрузки в память
4. **Индексирование**: быстрый поиск существующих клиентов

### Требования к ресурсам:
- RAM: минимум 512MB для 50k записей
- Диск: ~10MB для выходного xlsx файла
- Время выполнения: ~2-5 минут на стандартном ПК

## Вопросы для уточнения

### 1. Детализация форматов паспортов:
- Российский паспорт: формат "1234 123456" (серия + номер)?
- Белорусский паспорт: какой точный формат?
- Казахский паспорт: какой точный формат?

### 2. Специализации врачей:
- Нужны ли конкретные специализации или общие (терапевт, лор, кардиолог)?
- Включать ли узкие специализации (например, детский кардиолог)?

### 3. Симптомы и анализы:
- Создавать медицински корректные связи симптом->врач->анализ?
- Использовать реальные медицинские термины или упрощенные описания?

### 4. Географическая привязка:
- Учитывать ли региональную специфику (например, московское время для всех)?
- Нужны ли региональные различия в стоимости анализов?

### 5. Банковские карты:
- Использовать реальные BIN-коды банков или случайные номера?
- Генерировать номера по алгоритму Луна или простые комбинации?

### 6. Качество данных:
- Нужна ли проверка медицинской логики (несовместимые симптомы/анализы)?
- Требуется ли имитация сезонности заболеваний?

### 7. Расширенные функции:
- Добавить возможность экспорта в другие форматы (CSV, JSON)?
- Включить статистику по сгенерированным данным?
- Создать веб-интерфейс для настройки параметров?

## Примеры использования

### Базовая генерация:
```python
python dataset_generator.py --size 50000 --output clinic_dataset.xlsx
```

### С настройкой параметров:
```python
python dataset_generator.py --size 100000 --seed 12345 --repeat-probability 0.3
```

### Генерация с фильтрами:
```python
python dataset_generator.py --doctors "терапевт,кардиолог" --max-cost 5000
```